template<pint N>
defproc mem(chan?(bool) rd; chan?(int) addr, din; chan!(int) dout)
{
  int x[N];
  int a;
  bool b;
  chp {
    *[ log ("hi");
     [rd-> log("here"); addr?a, rd?; dout!x[a]
     []~rd -> log("there"); addr?a, rd?; din?x[a]
     ]]
  }
}

defproc test()
{
  mem<32> m;
  int x;

  chp {
     log("test mem");
     m.rd!false,m.addr!0,m.din!5;
     m.rd!false,m.addr!1,m.din!6;
     m.rd!true,m.addr!0,m.dout?x;
     log("got ", x);
     m.rd!true,m.addr!1,m.dout?x;
     log("got ", x)
   }
}
   
test t;
